<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CasaCejaRemake.ViewModels.POS"
        x:Class="CasaCejaRemake.Views.POS.PaymentView"
        x:DataType="vm:PaymentViewModel"
        Title="Cobro"
        Width="500"
        Height="450"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        Background="#1E1E1E">

    <Window.Styles>
        <Style Selector="Button.payment-method">
            <Setter Property="Background" Value="#3D3D3D"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="15,12"/>
            <Setter Property="Margin" Value="3"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Button.payment-method:pointerover">
            <Setter Property="Background" Value="#4D4D4D"/>
        </Style>
        <Style Selector="Button.payment-method-selected">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="15,12"/>
            <Setter Property="Margin" Value="3"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Button.quick-amount">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        <Style Selector="Button.quick-amount:pointerover">
            <Setter Property="Background" Value="#3D3D3D"/>
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="Auto,*,Auto,Auto" Margin="15">
        
        <!-- Header con total -->
        <Border Grid.Row="0" Background="#2D2D2D" Padding="15" CornerRadius="4" Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="TOTAL A PAGAR" 
                           FontSize="14" 
                           Foreground="#888" 
                           HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding TotalToPay, StringFormat='{}{ 0:C2}'}" 
                           FontSize="36" 
                           FontWeight="Bold" 
                           Foreground="#4CAF50" 
                           HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding TotalItems, StringFormat='{}{0} articulo(s)'}" 
                           FontSize="12" 
                           Foreground="#888" 
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Contenido principal -->
        <Grid Grid.Row="1" ColumnDefinitions="*,*" RowDefinitions="Auto,*">
            
            <!-- Metodos de pago -->
            <StackPanel Grid.Column="0" Grid.Row="0" Grid.RowSpan="2" Margin="0,0,10,0">
                <TextBlock Text="METODO DE PAGO" 
                           FontSize="12" 
                           Foreground="#888" 
                           FontWeight="Bold"
                           Margin="0,0,0,10"/>
                
                <Button Classes="payment-method" Command="{Binding SelectCashCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="$" FontWeight="Bold"/>
                        <TextBlock Text="Efectivo"/>
                    </StackPanel>
                </Button>
                
                <Button Classes="payment-method" Command="{Binding SelectDebitCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="TD"/>
                        <TextBlock Text="Tarjeta Debito"/>
                    </StackPanel>
                </Button>
                
                <Button Classes="payment-method" Command="{Binding SelectCreditCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="TC"/>
                        <TextBlock Text="Tarjeta Credito"/>
                    </StackPanel>
                </Button>
                
                <Button Classes="payment-method" Command="{Binding SelectTransferCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="TR"/>
                        <TextBlock Text="Transferencia"/>
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- Monto pagado (solo para efectivo) -->
            <StackPanel Grid.Column="1" Grid.Row="0" Grid.RowSpan="2" IsVisible="{Binding IsCashSelected}">
                <TextBlock Text="MONTO RECIBIDO" 
                           FontSize="12" 
                           Foreground="#888" 
                           FontWeight="Bold"
                           Margin="0,0,0,10"/>
                
                <TextBox x:Name="TxtAmountPaid"
                         Text="{Binding AmountPaid, Mode=TwoWay, StringFormat='{}{0:F2}'}"
                         FontSize="24"
                         FontWeight="Bold"
                         Padding="10"
                         Background="#3D3D3D"
                         Foreground="White"
                         BorderThickness="0"
                         CornerRadius="4"
                         HorizontalContentAlignment="Right"/>

                <!-- Botones de montos rapidos -->
                <WrapPanel Margin="0,10,0,0">
                    <Button Classes="quick-amount" Command="{Binding AddAmountCommand}" CommandParameter="20">+$20</Button>
                    <Button Classes="quick-amount" Command="{Binding AddAmountCommand}" CommandParameter="50">+$50</Button>
                    <Button Classes="quick-amount" Command="{Binding AddAmountCommand}" CommandParameter="100">+$100</Button>
                    <Button Classes="quick-amount" Command="{Binding AddAmountCommand}" CommandParameter="200">+$200</Button>
                    <Button Classes="quick-amount" Command="{Binding AddAmountCommand}" CommandParameter="500">+$500</Button>
                    <Button Classes="quick-amount" Command="{Binding ExactPaymentCommand}">Exacto</Button>
                    <Button Classes="quick-amount" Command="{Binding ClearAmountCommand}">Limpiar</Button>
                </WrapPanel>

                <!-- Cambio -->
                <Border Background="#2D2D2D" Padding="10" CornerRadius="4" Margin="0,15,0,0">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="CAMBIO:" 
                                   FontSize="16" 
                                   Foreground="White" 
                                   VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" 
                                   Text="{Binding Change, StringFormat='{}{0:C2}'}" 
                                   FontSize="24" 
                                   FontWeight="Bold" 
                                   Foreground="#4CAF50"/>
                    </Grid>
                </Border>
            </StackPanel>

            <!-- Mensaje para otros metodos -->
            <Border Grid.Column="1" 
                    Grid.Row="0" 
                    Grid.RowSpan="2" 
                    Background="#2D2D2D" 
                    Padding="15" 
                    CornerRadius="4"
                    IsVisible="{Binding !IsCashSelected}"
                    VerticalAlignment="Center">
                <TextBlock Text="Confirme el pago con el metodo seleccionado" 
                           Foreground="#888" 
                           TextWrapping="Wrap"
                           TextAlignment="Center"/>
            </Border>
        </Grid>

        <!-- Error message -->
        <TextBlock Grid.Row="2" 
                   Text="{Binding ErrorMessage}" 
                   Foreground="#F44336"
                   IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                   Margin="0,10,0,0"/>

        <!-- Botones de accion -->
        <Grid Grid.Row="3" ColumnDefinitions="*,*" Margin="0,15,0,0">
            <Button Grid.Column="0" 
                    Command="{Binding CancelCommand}"
                    Background="#3D3D3D"
                    Foreground="White"
                    Padding="15,12"
                    Margin="0,0,5,0"
                    CornerRadius="4"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="Esc" FontWeight="Bold"/>
                    <TextBlock Text="Cancelar"/>
                </StackPanel>
            </Button>
            
            <Button Grid.Column="1" 
                    Command="{Binding ConfirmCommand}"
                    IsEnabled="{Binding CanConfirm}"
                    Background="#4CAF50"
                    Foreground="White"
                    Padding="15,12"
                    Margin="5,0,0,0"
                    CornerRadius="4"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="Enter" FontWeight="Bold"/>
                    <TextBlock Text="Confirmar"/>
                </StackPanel>
            </Button>
        </Grid>
    </Grid>
</Window>