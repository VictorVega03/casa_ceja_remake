<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CasaCejaRemake.ViewModels.POS"
        xmlns:converters="using:CasaCejaRemake.Converters"
        x:Class="CasaCejaRemake.Views.POS.SalesView"
        x:DataType="vm:SalesViewModel"
        Title="Punto de Venta - Casa Ceja"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Background="#1E1E1E">

    <Window.Styles>
        <!-- Estilo para botones de accion -->
        <Style Selector="Button.action-button">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        <Style Selector="Button.action-button:pointerover">
            <Setter Property="Background" Value="#1084D8"/>
        </Style>
        <Style Selector="Button.danger-button">
            <Setter Property="Background" Value="#D32F2F"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        <Style Selector="Button.danger-button:pointerover">
            <Setter Property="Background" Value="#E53935"/>
        </Style>
        <Style Selector="Button.success-button">
            <Setter Property="Background" Value="#388E3C"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="20,15"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        <Style Selector="Button.success-button:pointerover">
            <Setter Property="Background" Value="#43A047"/>
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="Auto,*,Auto,Auto">
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#252525" Padding="15">
            <Border.Effect>
                <DropShadowEffect Color="#000000" Opacity="0.3" BlurRadius="10" OffsetX="0" OffsetY="2"/>
            </Border.Effect>
            <Grid ColumnDefinitions="*,Auto,*">
                <!-- Info izquierda -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="30">
                    <StackPanel>
                        <TextBlock Text="FOLIO DE CORTE" FontSize="10" Foreground="#888"/>
                        <TextBlock Text="{Binding CashCloseFolio}" FontSize="16" Foreground="White" FontWeight="Bold"/>
                    </StackPanel>
                    <StackPanel>
                        <TextBlock Text="COBRANZA" FontSize="10" Foreground="#888"/>
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <Button x:Name="BtnPrevCollection" 
                                    Content="â—€" 
                                    Background="#444" 
                                    Foreground="White"
                                    Padding="8,2"
                                    FontSize="14"
                                    VerticalAlignment="Center"
                                    ToolTip.Tip="Cobranza anterior (F5)"/>
                            <TextBlock Text="{Binding CurrentCollection}" FontSize="24" Foreground="#66BB6A" FontWeight="Bold" VerticalAlignment="Center"/>
                            <Button x:Name="BtnNextCollection" 
                                    Content="â–¶" 
                                    Background="#444" 
                                    Foreground="White"
                                    Padding="8,2"
                                    FontSize="14"
                                    VerticalAlignment="Center"
                                    ToolTip.Tip="Siguiente cobranza (F4)"/>
                        </StackPanel>
                    </StackPanel>
                    <!-- Indicadores de cobranzas con items -->
                    <StackPanel Orientation="Horizontal" Spacing="3" VerticalAlignment="Center">
                        <Button x:Name="BtnCollectionA" Content="A" Width="28" Height="28" FontSize="12" FontWeight="Bold" CornerRadius="4" Padding="0" ToolTip.Tip="Ir a cobranza A"/>
                        <Button x:Name="BtnCollectionB" Content="B" Width="28" Height="28" FontSize="12" FontWeight="Bold" CornerRadius="4" Padding="0" ToolTip.Tip="Ir a cobranza B"/>
                        <Button x:Name="BtnCollectionC" Content="C" Width="28" Height="28" FontSize="12" FontWeight="Bold" CornerRadius="4" Padding="0" ToolTip.Tip="Ir a cobranza C"/>
                        <Button x:Name="BtnCollectionD" Content="D" Width="28" Height="28" FontSize="12" FontWeight="Bold" CornerRadius="4" Padding="0" ToolTip.Tip="Ir a cobranza D"/>
                    </StackPanel>
                </StackPanel>

                <!-- Titulo central -->
                <TextBlock Grid.Column="1" 
                           Text="PUNTO DE VENTA" 
                           FontSize="24" 
                           FontWeight="Bold" 
                           Foreground="#E0E0E0"
                           VerticalAlignment="Center"/>

                <!-- Info derecha -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="30" HorizontalAlignment="Right">
                    <StackPanel>
                        <TextBlock Text="SUCURSAL" FontSize="10" Foreground="#888"/>
                        <TextBlock Text="{Binding Branch}" FontSize="14" Foreground="White"/>
                    </StackPanel>
                    <StackPanel>
                        <TextBlock Text="USUARIO" FontSize="10" Foreground="#888"/>
                        <TextBlock Text="{Binding User}" FontSize="14" Foreground="White"/>
                    </StackPanel>
                    <StackPanel>
                        <TextBlock Text="FECHA/HORA" FontSize="10" Foreground="#888"/>
                        <TextBlock x:Name="TxtFechaHora" Text="{Binding FechaHora}" FontSize="14" Foreground="White"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Area principal -->
        <Grid Grid.Row="1" ColumnDefinitions="*,300" Margin="10">
            
            <!-- Panel izquierdo: Codigo de barras y DataGrid -->
            <Grid Grid.Column="0" RowDefinitions="Auto,*" Margin="0,0,10,0">
                
                <!-- Input de codigo de barras -->
                <Border Grid.Row="0" Background="#2D2D2D" Padding="15" CornerRadius="4" Margin="0,0,0,10">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <TextBlock Grid.Column="0" 
                                   Text="CODIGO:" 
                                   VerticalAlignment="Center" 
                                   Foreground="White"
                                   FontSize="16"
                                   Margin="0,0,10,0"/>
                        <TextBox x:Name="TxtBarcode"
                                 Grid.Column="1"
                                 Text="{Binding Barcode, Mode=TwoWay}"
                                 FontSize="18"
                                 Padding="10"
                                 Background="#3D3D3D"
                                 Foreground="White"
                                 BorderThickness="0"
                                 CornerRadius="4"/>
                        <TextBlock Grid.Column="2"
                                   Text="F1"
                                   VerticalAlignment="Center"
                                   Foreground="#888"
                                   FontSize="12"
                                   Margin="10,0,0,0"/>
                    </Grid>
                </Border>

                <!-- DataGrid de productos -->
                <Border Grid.Row="1" Background="#2D2D2D" Padding="10" CornerRadius="4">
                    <DataGrid x:Name="GridProducts"
                              ItemsSource="{Binding Items}"
                              SelectedIndex="{Binding SelectedItemIndex, Mode=TwoWay}"
                              SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              Background="#2D2D2D"
                              BorderThickness="0">
                        <DataGrid.RowBackground>
                            <SolidColorBrush Color="#2D2D2D"/>
                        </DataGrid.RowBackground>
                        <DataGrid.Styles>
                            <!-- Color base para filas normales -->
                            <Style Selector="DataGridRow">
                                <Setter Property="Background" Value="#2D2D2D"/>
                            </Style>
                            <Style Selector="DataGridRow:nth-child(even)">
                                <Setter Property="Background" Value="#353535"/>
                            </Style>
                            <!-- Selector con color sÃ³lido que cubre el fondo -->
                            <Style Selector="DataGridRow:pointerover">
                                <Setter Property="Background" Value="#3D3D3D"/>
                            </Style>
                            <Style Selector="DataGridRow:selected">
                                <Setter Property="Background" Value="#0078D4"/>
                            </Style>
                            <Style Selector="DataGridRow:selected:pointerover">
                                <Setter Property="Background" Value="#1084D8"/>
                            </Style>
                            <Style Selector="DataGridCell">
                                <Setter Property="Foreground" Value="White"/>
                            </Style>
                            <Style Selector="DataGridColumnHeader">
                                <Setter Property="Foreground" Value="#888"/>
                                <Setter Property="Background" Value="#2D2D2D"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Style>
                        </DataGrid.Styles>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="CÃ“DIGO" 
                                                Binding="{Binding Barcode}" 
                                                Width="120"/>
                            <DataGridTextColumn Header="ARTICULO" 
                                                Binding="{Binding ProductName}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="CANTIDAD" 
                                                Binding="{Binding Quantity}" 
                                                Width="100"/>
                            <DataGridTextColumn Header="PRECIO" 
                                                Binding="{Binding FinalUnitPrice, StringFormat='{}{0:C2}'}" 
                                                Width="120"/>
                            <DataGridTextColumn Header="TOTAL" 
                                                Binding="{Binding LineTotal, StringFormat='{}{0:C2}'}" 
                                                Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </Grid>

            <!-- Panel derecho: Totales y acciones rapidas -->
            <Grid Grid.Column="1" RowDefinitions="Auto,*,Auto">
                
                <!-- Totales -->
                <Border Grid.Row="0" Background="#2D2D2D" Padding="15" CornerRadius="4" Margin="0,0,0,10">
                    <StackPanel Spacing="10">
                        <TextBlock Text="RESUMEN" FontSize="14" Foreground="#888" FontWeight="Bold"/>
                        
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Text="Articulos:" Foreground="White"/>
                            <TextBlock Grid.Column="1" Text="{Binding TotalItems}" Foreground="White" FontWeight="Bold"/>
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Text="Descuento:" Foreground="#FF9800"/>
                            <TextBlock Grid.Column="1" Text="{Binding TotalDiscountDisplay, StringFormat='-{0:C2}'}" Foreground="#FF9800"/>
                        </Grid>
                        
                        <Separator Background="#444"/>
                        
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Text="TOTAL:" FontSize="20" Foreground="White" FontWeight="Bold"/>
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding FinalTotal, StringFormat='{}{0:C2}'}" 
                                       FontSize="28" 
                                       Foreground="#66BB6A" 
                                       FontWeight="Bold"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Acciones rapidas -->
                <ScrollViewer Grid.Row="1" 
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Disabled">
                    <Border Background="#2D2D2D" Padding="10" CornerRadius="4">
                        <StackPanel Spacing="5">
                            <TextBlock Text="ACCIONES" FontSize="12" Foreground="#888" FontWeight="Bold" Margin="5,0,0,5"/>
                            
                            <Button Classes="action-button" Command="{Binding FocusBarcodeCommand}" HorizontalAlignment="Stretch" Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="F1" FontWeight="Bold"/>
                                    <TextBlock Text="Codigo Barras"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="action-button" Command="{Binding ModifyQuantityCommand}" HorizontalAlignment="Stretch" Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="F2" FontWeight="Bold"/>
                                    <TextBlock Text="Modificar Cantidad"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="action-button" Command="{Binding SearchProductCommand}" HorizontalAlignment="Stretch" Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="F3" FontWeight="Bold"/>
                                    <TextBlock Text="Buscar Producto"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="action-button" Command="{Binding ChangeCollectionCommand}" HorizontalAlignment="Stretch" Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="F4" FontWeight="Bold"/>
                                    <TextBlock Text="Siguiente Cobranza"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="action-button" Command="{Binding ChangeCollectionPreviousCommand}" HorizontalAlignment="Stretch" Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="F5" FontWeight="Bold"/>
                                    <TextBlock Text="Cobranza Anterior"/>
                                </StackPanel>
                            </Button>
                            
                            <Separator Background="#444" Margin="0,5"/>
                            
                            <Button Classes="danger-button" Command="{Binding RemoveProductCommand}" HorizontalAlignment="Stretch" Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Supr" FontWeight="Bold"/>
                                    <TextBlock Text="Quitar Producto"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="danger-button" Command="{Binding ClearCartCommand}" HorizontalAlignment="Stretch" Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Shift+F5" FontWeight="Bold"/>
                                    <TextBlock Text="Vaciar Carrito"/>
                                </StackPanel>
                            </Button>
                            
                            <Separator Background="#444" Margin="0,5"/>
                            
                            <Button Classes="action-button" 
                                    x:Name="BtnCustomers"
                                    HorizontalAlignment="Stretch"
                                    Background="#FF9800"
                                    Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="F8" FontWeight="Bold"/>
                                    <TextBlock Text="Clientes"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="action-button" 
                                    Command="{Binding CreditsLayawaysCommand}" 
                                    HorizontalAlignment="Stretch"
                                    Background="#9C27B0"
                                    Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="F12" FontWeight="Bold"/>
                                    <TextBlock Text="CrÃ©ditos/Apartados"/>
                                </StackPanel>
                            </Button>
                            
                            <Separator Background="#444" Margin="0,5"/>
                            
                            <!-- Botones de Descuento -->
                            <Button x:Name="BtnSpecialPrice"
                                    Classes="action-button" 
                                    Command="{Binding ApplySpecialPriceCommand}" 
                                    HorizontalAlignment="Stretch"
                                    Background="#FFC107"
                                    Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Ctrl+F2" FontWeight="Bold" Foreground="#333"/>
                                    <TextBlock Text="Precio Especial" Foreground="#333"/>
                                </StackPanel>
                            </Button>
                            
                            <Button x:Name="BtnDealerPrice"
                                    Classes="action-button" 
                                    Command="{Binding ApplyDealerPriceCommand}" 
                                    HorizontalAlignment="Stretch"
                                    Background="#2196F3"
                                    Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Ctrl+F3" FontWeight="Bold"/>
                                    <TextBlock Text="Precio Vendedor"/>
                                </StackPanel>
                            </Button>
                            
                            <Button x:Name="BtnGeneralDiscount"
                                    Classes="action-button" 
                                    Command="{Binding ShowGeneralDiscountCommand}" 
                                    HorizontalAlignment="Stretch"
                                    Background="#4CAF50"
                                    Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Ctrl+F6" FontWeight="Bold"/>
                                    <TextBlock Text="Descuento General"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>
                </ScrollViewer>

                <!-- Boton de pagar -->
                <Button Grid.Row="2" 
                        Classes="success-button" 
                        Command="{Binding PayCommand}"
                        HorizontalAlignment="Stretch"
                        Margin="0,10,0,0">
                    <StackPanel Orientation="Horizontal" Spacing="15">
                        <TextBlock Text="F11" FontWeight="Bold" FontSize="18"/>
                        <TextBlock Text="PAGAR" FontSize="18"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Grid>

        <!-- Barra de estado -->
        <Border Grid.Row="2" Background="#2D2D2D" Padding="10">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding StatusMessage}" 
                           Foreground="#888" 
                           VerticalAlignment="Center"/>
                <TextBlock Grid.Column="1" 
                           Text="Usa los botones o atajos de teclado para navegar" 
                           Foreground="#666" 
                           FontSize="11"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Barra inferior con menu salir -->
        <Border Grid.Row="3" Background="#1A1A1A" Padding="10">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                    <!-- BotÃ³n de ayuda - Leyenda de colores -->
                    <Button x:Name="BtnHelp"
                            Content="?"
                            Width="32"
                            Height="32"
                            FontSize="18"
                            FontWeight="Bold"
                            Background="#444"
                            Foreground="White"
                            CornerRadius="16"
                            VerticalAlignment="Center"
                            ToolTip.Tip="Leyenda de colores"
                            Cursor="Hand"/>
                    
                    <TextBlock Text="Casa Ceja - Sistema de Punto de Venta v1.0" 
                               Foreground="#555" 
                               FontSize="11"
                               VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Dropdown Button para Salir -->
                <Button x:Name="BtnExitMenu"
                        Grid.Column="1" 
                        Classes="danger-button" 
                        Padding="20,8"
                        Background="#D32F2F">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <TextBlock Text="MENÃš" FontWeight="Bold"/>
                        <TextBlock Text="â–¼" FontSize="10"/>
                    </StackPanel>
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="ðŸšª Salir" Command="{Binding ExitCommand}"/>
                            <MenuItem Header="ðŸ”“ Cerrar SesiÃ³n" Command="{Binding LogoutCommand}"/>
                            <Separator/>
                            <MenuItem Header="âš™ ConfiguraciÃ³n de Terminal" Click="OnPosConfigClick"/>
                            <Separator/>
                            <MenuItem Header="ðŸ’° Corte de Caja (F10)" Click="OnCashCloseClick"/>
                            <MenuItem Header="ðŸ“Š Historial de Cortes (F9)" Click="OnCashCloseHistoryClick"/>
                            <MenuItem Header="ðŸ“‹ Historial de Ventas" Click="OnSalesHistoryClick"/>
                            <Separator/>
                            <MenuItem Header="âž– Gasto (F6)" Click="OnExpenseClick"/>
                            <MenuItem Header="âž• Ingreso (F7)" Click="OnIncomeClick"/>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
            </Grid>
        </Border>

        <!-- Indicador de procesamiento -->
        <Border Grid.RowSpan="4"
                Background="#80000000"
                IsVisible="{Binding IsProcessing}">
            <Border Background="#2D2D2D" 
                    Padding="30" 
                    CornerRadius="8"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <StackPanel Spacing="15">
                    <ProgressBar IsIndeterminate="True" Width="200"/>
                    <TextBlock Text="Procesando..." 
                               Foreground="White" 
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</Window>